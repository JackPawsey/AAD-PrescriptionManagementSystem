@page
@using AADWebApp.Services
@model AADWebApp.Areas.Patient.Pages.ScheduleCollectionModel
@{
    ViewData["Title"] = "Schedule Collection";
    Layout = "~/Areas/Patient/Pages/_PatientLayout.cshtml";
}

<h1 class="mb-5">Schedule Prescription Collections</h1>

<h2 class="mb-5">Upcoming Collections</h2>

@if (TempData["EnterPrescriptionCollectionDateTimeSuccess"] != null)
{
    <p class="mb-2 p-2 bg-success text-white rounded">@TempData["EnterPrescriptionCollectionDateTimeSuccess"]</p>
}
else if (TempData["EnterPrescriptionCollectionDateTimeFailure"] != null)
{
    <p class="mb-2 p-2 bg-danger text-white rounded">@TempData["EnterPrescriptionCollectionDateTimeFailure"]</p>
}

<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th scope="col">Prescription ID</th>
        <th scope="col">Medication Name</th>
        <th scope="col">Prescription Start</th>
        <th scope="col">Prescription End</th>
        <th scope="col">Collection Status</th>
        <th scope="col">Collection Status Last Updated</th>
        <th scope="col">Current Collection Date/Time</th>
        <th scope="col">New Collection Date</th>
        <th scope="col">New Collection Time</th>
    </tr>
    </thead>
    <tbody>
    @for (var i = 0; i < Model.Prescriptions.Count; i++)
    {
        <form method="post">
            <input type="hidden" value="@Model.Prescriptions[i].Id" name="PrescriptionId" />
            <tr>
                @for (var x = 0; x < Model.PrescriptionCollections[i].Count; x++)
                {
                    if (Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus == PrescriptionCollectionService.CollectionStatus.Pending || Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus == PrescriptionCollectionService.CollectionStatus.BeingPrepared || Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus == PrescriptionCollectionService.CollectionStatus.CollectionReady)
                    {
                        <td>@Model.Prescriptions[i].Id</td>
                        <td>@Model.Medications[i].MedicationName</td>
                        <td>@Model.Prescriptions[i].DateStart.ToShortDateString()</td>
                        <td>@Model.Prescriptions[i].DateEnd.ToShortDateString()</td>

                        <td>@Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus</td>
                        <td>@Model.PrescriptionCollections[i].ElementAt(x).CollectionStatusUpdated</td>
                        <td>@Model.PrescriptionCollections[i].ElementAt(x).CollectionTime</td>

                        @if (Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus != PrescriptionCollectionService.CollectionStatus.CollectionReady)
                        {
                            <td>
                                <input required type="date" class="form-control" />
                            </td>
                            <td>
                                <input required type="time" class="form-control" name="CollectionDateTime">
                            </td>
                            <td>
                                <input type="submit" class="btn btn-primary float-right" value="Schedule" />
                            </td>
                        }
                    }
                }
            </tr>
        </form>
    }
    </tbody>
</table>

<h2 class="mb-5">Past Collections</h2>

<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th scope="col">Prescription ID</th>
        <th scope="col">Medication Name</th>
        <th scope="col">Prescription Start</th>
        <th scope="col">Prescription End</th>
        <th scope="col">Collection Status</th>
    </tr>
    </thead>
    <tbody>
    @for (var i = 0; i < Model.Prescriptions.Count; i++)
    {
        <form method="post">
            <input type="hidden" value="@Model.Prescriptions[i].Id" name="PrescriptionId" />
            <tr>
                @for (var x = 0; x < Model.PrescriptionCollections[i].Count; x++)
                {
                    if (Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus == PrescriptionCollectionService.CollectionStatus.Collected || Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus == PrescriptionCollectionService.CollectionStatus.Cancelled)
                    {
                        {
                            <td>@Model.Prescriptions[i].Id</td>
                            <td>@Model.Medications[i].MedicationName</td>
                            <td>@Model.Prescriptions[i].DateStart.ToShortDateString()</td>
                            <td>@Model.Prescriptions[i].DateEnd.ToShortDateString()</td>
                            <td>@Model.PrescriptionCollections[i].ElementAt(x).CollectionStatus</td>
                        }
                    }
                }
            </tr>
        </form>
    }
    </tbody>
</table>

<!--Modal-->
<div class=" modal fade" tabindex="-1" id="Schedule">
    <div class=" modal-dialog modal-lg" role="form">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle"> Schedule</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">

                <table class="table table-striped table-hover table-responsive">
                    <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Medication ID</th>
                        <th scope="col">Medication Name</th>
                        <th scope="col">Medication Start</th>
                        <th scope="col">Medication End</th>
                        <th scope="col">Collection Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    @for (var i = 0; i < 6; i++)
                    {
                        <tr data-toggle="modal" data-target="#EnterResults" class="table-success">
                            <th scope="row">@(i + 1)</th>
                            <td>Text</td>
                            <td>Text</td>
                            <td>
                                <input type="date" class="form-control-sm" name="Medication Start" id="Medication Start" />
                            </td>
                            <td>
                                <input type="date" class="form-control-sm" name="Medication End" id="Medication End" />
                            </td>
                            <td>Ready for Pickup</td>
                        </tr>
                    }
                    </tbody>
                </table>
                <div class="form-group">
                    <h5 class="mt-3">Date and Time</h5>
                    <div class="form-check-inline mt-2">
                        <h6 class="ml-3">Date</h6>
                        <input type="date" name="resultDate" class="form-control col-sm-4 ml-4">
                        <h6 class="ml-3"> Time</h6>
                        <input type="time" name="resultTime" class="form-control col-sm-4 ml-4">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary float-right">Confirm</button>
            </div>
        </div>
    </div>
</div>
@*<button  data-toggle="modal" data-target="#Schedule" class="btn btn-primary float-right mt-3">Schedule</button>*@